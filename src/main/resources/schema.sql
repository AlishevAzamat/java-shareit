DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS item_requests CASCADE;
DROP TABLE IF EXISTS items CASCADE;
DROP TABLE IF EXISTS booking CASCADE;
DROP TABLE IF EXISTS comments CASCADE;

CREATE TABLE IF NOT EXISTS users (
  id            BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name          VARCHAR(255) NOT NULL,
  email         VARCHAR(512) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS item_requests (
  id            BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  owner_id      BIGINT REFERENCES users (id) ON DELETE CASCADE,
  description   varchar(512) NOT NULL,
  created_date  timestamp
);

CREATE TABLE IF NOT EXISTS items (
  id            BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  owner_id      BIGINT REFERENCES users (id) ON DELETE CASCADE,
  name          VARCHAR(255) NOT NULL,
  description   VARCHAR(512) NOT NULL,
  is_available  boolean,
  request_id    BIGINT REFERENCES item_requests (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS booking (
  id            BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  start_date    TIMESTAMP NOT NULL,
  end_date      TIMESTAMP NOT NULL,
  booker_id     BIGINT REFERENCES users (id) ON DELETE CASCADE,
  item_id       BIGINT REFERENCES items (id) ON DELETE CASCADE,
  status        VARCHAR(512) NOT NULL
);

CREATE TABLE IF NOT EXISTS comments (
  id            BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  text          VARCHAR(512) NOT NULL,
  item_id       BIGINT REFERENCES items (id) ON DELETE CASCADE,
  author_id     BIGINT REFERENCES users (id) ON DELETE CASCADE,
  created       TIMESTAMP NOT NULL
);

